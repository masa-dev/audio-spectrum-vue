(function(){"use strict";var e={5972:function(e,t,i){var n=i(8935),a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"app"}},[i("button",{on:{click:function(t){return e.click()}}},[e._v("click")]),e._m(0)])},r=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("canvas",{attrs:{id:"my-canvas"}})])}],o=i(3796),s=(i(8675),i(3462),i(7380),i(1118),i(6164)),l=i(6166),u=i.n(l),c=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"canvas-wrapper"},[i("canvas",{attrs:{id:"basic-visualiser",width:"500",height:"200"}}),i("div",[e._v(" "+e._s(e.mediaUrl)+" "),i("button",{on:{click:function(t){return e.play()}}},[e._v("start")]),i("button",{on:{click:function(t){return e.playOrPause()}}},[e._v(e._s(e.btnText))])])])},d=[],f=function(e,t,i,n){var a,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(o=(r<3?a(o):r>3?a(t,i,o):a(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let h=class extends s.w3{constructor(...e){super(...e),(0,o.Z)(this,"mediaUrl",void 0),(0,o.Z)(this,"canvasEl",null),(0,o.Z)(this,"canvasCtx",null),(0,o.Z)(this,"audioCtx",new AudioContext),(0,o.Z)(this,"analyserNode",this.audioCtx.createAnalyser()),(0,o.Z)(this,"gainNode",new GainNode(this.audioCtx)),(0,o.Z)(this,"sourceNode",this.audioCtx.createBufferSource()),(0,o.Z)(this,"mediaBuffer",null),(0,o.Z)(this,"isFirstPlay",!0),(0,o.Z)(this,"isPlaying",!1),(0,o.Z)(this,"btnText","start")}async getAudioArrayBuffer(e){let t=u()(e,{responseType:"arraybuffer",method:"GET"});return t}init(){this.audioCtx=new AudioContext,this.analyserNode=this.audioCtx.createAnalyser(),this.gainNode=new GainNode(this.audioCtx),this.sourceNode=this.audioCtx.createBufferSource(),this.gainNode.gain.value=.3,console.log("initted")}async play(){this.isFirstPlay||this.sourceNode.stop(),this.mediaBuffer?(this.mediaBuffer=(await this.getAudioArrayBuffer(this.mediaUrl)).data,this.init(),await this.audioCtx.decodeAudioData(this.mediaBuffer,(e=>{const t=500,i=200;this.sourceNode.buffer=e;new Uint8Array(this.analyserNode.frequencyBinCount);this.analyserNode.fftSize=256,this.sourceNode.connect(this.analyserNode),this.sourceNode.connect(this.gainNode).connect(this.audioCtx.destination),this.sourceNode.start(0),this.isPlaying=!1,this.analyserNode.fftSize=128;let n=this.analyserNode.frequencyBinCount;console.log(n);let a=new Uint8Array(n);console.log(a),this.canvasCtx.clearRect(0,0,t,i);let r=0,o=this.analyserNode,s=this.canvasCtx;function l(){r=requestAnimationFrame(l),o.getByteFrequencyData(a),s.fillStyle="rgb(0, 0, 0)",s.clearRect(0,0,t,i),s.fillStyle="rgb(0, 0, 0, 0)",s.fillRect(0,0,t,i);let e,u=t/n*1.3,c=0;for(let t=0;t<n;t++)e=1.5*a[t],s.fillStyle="rgb("+(e+100)+",50,50)",s.fillRect(c,i-e/2,u,e),c+=u+1}l(),this.sourceNode.onended=()=>{this.audioCtx.close(),this.isFirstPlay=!0,this.isPlaying=!1}}))):setTimeout((()=>{this.play()}),500)}playOrPause(){this.isPlaying?(this.audioCtx.suspend(),this.isPlaying=!1,this.btnText="start"):(this.audioCtx.resume(),this.isPlaying=!0,this.btnText="stop")}async mounted(){this.canvasEl=document.getElementById("basic-visualiser"),this.canvasCtx=this.canvasEl.getContext("2d"),this.mediaBuffer=(await this.getAudioArrayBuffer(this.mediaUrl)).data,this.gainNode.gain.value=.2}};f([(0,s.fI)({type:String,default:""})],h.prototype,"mediaUrl",void 0),h=f([s.wA],h);var v=h,y=v,p=i(1001),g=(0,p.Z)(y,c,d,!1,null,null,null),m=g.exports,b=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("canvas",{attrs:{id:"visualiser-canvas",width:e.visualWidth,height:e.visualHeight}}),i("input",{attrs:{type:"file",id:"audio-input"},on:{change:e.inputAudioFile}}),i("button",{on:{click:e.play}},[e._v("PLAY")]),i("b-icon-volume-down-fill"),i("input",{directives:[{name:"model",rawName:"v-model",value:e.volume,expression:"volume"}],attrs:{type:"range",id:"volume-controller",min:"0",max:"1",step:"0.05"},domProps:{value:e.volume},on:{input:e.inputVolume,__r:function(t){e.volume=t.target.value}}}),i("b-icon-volume-up-fill"),i("div",{attrs:{id:"color-picker"}}),i("select",{directives:[{name:"model",rawName:"v-model",value:e.visualiserType,expression:"visualiserType"}],attrs:{id:""},on:{change:function(t){var i=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.visualiserType=t.target.multiple?i:i[0]}}},[i("option",{attrs:{value:"simple-bar",selected:""}},[e._v("Simple Bar")]),i("option",{attrs:{value:"line-bar"}},[e._v("Line Bar")])])],1)},x=[];function C(e,t,i){let n=0;for(let a=t;a<=i;a++)n+=e[a];return n/(i-t+1)}function w(e,t,i,n,a,r,o){t.getByteFrequencyData(n),e.fillStyle="rgb(0, 0, 0)",e.clearRect(0,0,a,r),e.fillStyle="rgb(0, 0, 0, 0)",e.fillRect(0,0,a,r);const s=a/i*1.1;let l,u=0;for(let c=0;c<i;c++)l=n[c]/128*r*.9,e.fillStyle=o,e.fillRect(u,r-l/2,s,l),u+=s+1}function N(e,t,i,n,a,r,o){t.getByteFrequencyData(n),e.fillStyle="rgb(0, 0, 0)",e.clearRect(0,0,a,r),e.fillStyle="rgb(0, 0, 0, 0)",e.fillRect(0,0,a,r);const s=16,l=a/s*.9,u=i/s;let c=0;for(let d=0;d<s;d++){const t=C(n,d*u,(d+1)*u),i=Math.floor(t/10);for(let n=0;n<i;n++){const t=r-20*n+10;e.beginPath(),e.moveTo(c,t),e.lineTo(c+l,t),e.strokeStyle=o,e.lineWidth=10,e.stroke()}c+=l+10}}var A=i(4638),B=i.n(A),Z=function(e,t,i,n){var a,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(o=(r<3?a(o):r>3?a(t,i,o):a(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const S={el:"#color-picker",theme:"classic",swatches:["rgba(244, 67, 54, 0.6)","rgba(103, 58, 183, 0.85)","rgba(63, 81, 181, 0.8)","rgba(0, 188, 212, 0.7)","rgba(76, 175, 80, 0.8)"],default:"#F5732499",components:{preview:!0,opacity:!0,hue:!0,interaction:{hex:!0,rgba:!0,input:!0,save:!0}}};let _=class extends s.w3{constructor(...e){super(...e),(0,o.Z)(this,"visualWidth",100),(0,o.Z)(this,"visualHeight",100),(0,o.Z)(this,"canvasEl",null),(0,o.Z)(this,"canvasCtx",null),(0,o.Z)(this,"audioFile",null),(0,o.Z)(this,"audioCtx",new AudioContext),(0,o.Z)(this,"analyserNode",this.audioCtx.createAnalyser()),(0,o.Z)(this,"gainNode",new GainNode(this.audioCtx)),(0,o.Z)(this,"sourceNode",this.audioCtx.createBufferSource()),(0,o.Z)(this,"audioBuffer",null),(0,o.Z)(this,"volume",.2),(0,o.Z)(this,"pickr",null),(0,o.Z)(this,"barColor","#F5732499"),(0,o.Z)(this,"visualiserType","simple-bar"),(0,o.Z)(this,"audioArrayBuffer",null)}mounted(){this.canvasEl=document.getElementById("visualiser-canvas"),this.canvasCtx=this.canvasEl.getContext("2d"),this.gainNode.gain.value=this.volume,this.resizeCanvas(),window.onresize=()=>{this.resizeCanvas()},this.pickr=B().create(S),this.pickr.on("save",(e=>{this.barColor=e.toRGBA().toString()}))}resizeCanvas(){this.visualWidth=window.innerWidth,this.visualHeight=.8*window.innerHeight}async inputAudioFile(e){const t=e.target;this.audioFile=t.files[0],this.audioArrayBuffer=await this.audioFile.arrayBuffer()}inputVolume(e){const t=e.target;this.volume=parseFloat(t.value),this.gainNode.gain.value=this.volume}initAudioInstances(){const e=this.gainNode.gain.value;this.audioCtx=new AudioContext,this.analyserNode=this.audioCtx.createAnalyser(),this.sourceNode=this.audioCtx.createBufferSource(),this.gainNode=this.audioCtx.createGain(),this.gainNode.gain.value=e}async play(){if(null===this.audioFile)return void alert("音声ファイルが入力されていません");const e=this;this.initAudioInstances(),this.audioBuffer=null;const t=document.getElementById("audio-input");this.audioFile.arrayBuffer(),this.audioBuffer=await this.audioCtx.decodeAudioData(await t.files[0].arrayBuffer()),this.sourceNode.buffer=this.audioBuffer,this.sourceNode.connect(this.analyserNode),this.sourceNode.connect(this.gainNode).connect(this.audioCtx.destination),this.sourceNode.start(0),console.log("started"),this.sourceNode.onended=()=>{console.log("ended")},this.analyserNode.fftSize=128;const i=this.analyserNode.frequencyBinCount,n=new Uint8Array(i),a=this.canvasCtx,r=this.analyserNode;function o(){requestAnimationFrame(o),"simple-bar"===e.visualiserType?w(a,r,i,n,e.visualWidth,e.visualHeight,e.barColor):"line-bar"===e.visualiserType&&N(a,r,i,n,e.visualWidth,e.visualHeight,e.barColor)}this.canvasCtx.clearRect(0,0,this.visualWidth,this.visualHeight),o()}};_=Z([s.wA],_);var P=_,T=P,O=(0,p.Z)(T,b,x,!1,null,null,null),k=O.exports,R=function(e,t,i,n){var a,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(o=(r<3?a(o):r>3?a(t,i,o):a(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let E=class extends s.w3{constructor(...e){super(...e),(0,o.Z)(this,"canvasEl",null)}async getAudioArrayBuffer(e){let t=u()(e,{responseType:"arraybuffer",method:"GET"});return t}async click(){this.canvasEl=document.getElementById("my-canvas");const e=this.canvasEl.getContext("2d"),t=new AudioContext,i=t.createAnalyser(),n=(await this.getAudioArrayBuffer("/music/季節は次々死んでいく.mp3")).data;t.decodeAudioData(n,(function(n){const a=t.createBufferSource();a.buffer=n;const r=t.createGain();r.gain.value=.3;const o=new Uint8Array(i.frequencyBinCount);a.connect(i),a.connect(r).connect(t.destination),a.start(0),setInterval((()=>{i.getByteTimeDomainData(o),e.fillStyle="rgb(200, 200, 200)",e.fillRect(0,0,200,200),e.lineWidth=2,e.strokeStyle="rgb(0, 0, 0)",e.beginPath();let t=200/o.length,n=0;for(let i=0;i<o.length;i++){let r=o[i]/128;var a=200*r/2;0===i?e.moveTo(n,a):e.lineTo(n,a),n+=t}e.lineTo(200,100),e.stroke()}),10)}))}};E=R([(0,s.wA)({components:{BasicAudioVisualiserTest:m,BasicAudioVisualiser:k}})],E);var F=E,j=F,D=(0,p.Z)(j,a,r,!1,null,null,null),q=D.exports,G=i(4665);n["default"].use(G.ZP);var U=new G.ZP.Store({state:{},getters:{},mutations:{},actions:{},modules:{}}),W=i(8262),I=i(3266);i(44);n["default"].use(W.XG7),n["default"].use(I.A7),n["default"].config.productionTip=!1,new n["default"]({store:U,render:e=>e(q)}).$mount("#app")}},t={};function i(n){var a=t[n];if(void 0!==a)return a.exports;var r=t[n]={exports:{}};return e[n](r,r.exports,i),r.exports}i.m=e,function(){var e=[];i.O=function(t,n,a,r){if(!n){var o=1/0;for(c=0;c<e.length;c++){n=e[c][0],a=e[c][1],r=e[c][2];for(var s=!0,l=0;l<n.length;l++)(!1&r||o>=r)&&Object.keys(i.O).every((function(e){return i.O[e](n[l])}))?n.splice(l--,1):(s=!1,r<o&&(o=r));if(s){e.splice(c--,1);var u=a();void 0!==u&&(t=u)}}return t}r=r||0;for(var c=e.length;c>0&&e[c-1][2]>r;c--)e[c]=e[c-1];e[c]=[n,a,r]}}(),function(){i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,{a:t}),t}}(),function(){i.d=function(e,t){for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};i.O.j=function(t){return 0===e[t]};var t=function(t,n){var a,r,o=n[0],s=n[1],l=n[2],u=0;if(o.some((function(t){return 0!==e[t]}))){for(a in s)i.o(s,a)&&(i.m[a]=s[a]);if(l)var c=l(i)}for(t&&t(n);u<o.length;u++)r=o[u],i.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return i.O(c)},n=self["webpackChunkaudio_spectrum"]=self["webpackChunkaudio_spectrum"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=i.O(void 0,[998],(function(){return i(5972)}));n=i.O(n)})();
//# sourceMappingURL=app.516d89b5.js.map